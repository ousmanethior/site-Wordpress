/*
Copyright 2014 Igor Vaynberg

Version: 3.4.8 Timestamp: Thu May  1 09:50:32 EDT 2014

This software is licensed under the Apache License, Version 2.0 (the "Apache License") or the GNU
General Public License version 2 (the "GPL License"). You may choose either license to govern your
use of this software only upon the condition that you accept all of the terms of either the Apache
License or the GPL License.

You may obtain a copy of the Apache License and the GPL License at:

http://www.apache.org/licenses/LICENSE-2.0
http://www.gnu.org/licenses/gpl-2.0.html

Unless required by applicable law or agreed to in writing, software distributed under the Apache License
or the GPL Licesnse is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied. See the Apache License and the GPL License for the specific language governing
permissions and limitations under the Apache License and the GPL License.
*/
!function(t){void 0===t.fn.eachTwo&&t.extend(t.fn,{eachTwo:function(e){for(var s=t([0]),i=-1,o=this.length;++i<o&&(s.context=s[0]=this[i])&&!1!==e.call(s[0],i,s););return this}})}(jQuery),function(t,e){"use strict";function s(e){var s=t(document.createTextNode(""));e.before(s),s.before(e),s.remove()}function i(t){return t.replace(/[^\u0000-\u007E]/g,function(t){return z[t]||t})}function o(t,e){for(var s=0,i=e.length;s<i;s+=1)if(a(t,e[s]))return s;return-1}function n(){var e=t(F);e.appendTo("body");var s={width:e.width()-e[0].clientWidth,height:e.height()-e[0].clientHeight};return e.remove(),s}function a(t,s){return t===s||t!==e&&s!==e&&(null!==t&&null!==s&&(t.constructor===String?t+""==s+"":s.constructor===String&&s+""==t+""))}function c(e,s){var i,o,n;if(null===e||e.length<1)return[];for(o=0,n=(i=e.split(s)).length;o<n;o+=1)i[o]=t.trim(i[o]);return i}function r(t){return t.outerWidth(!1)-t.width()}function l(s){var i="keyup-change-value";s.on("keydown",function(){t.data(s,i)===e&&t.data(s,i,s.val())}),s.on("keyup",function(){var o=t.data(s,i);o!==e&&s.val()!==o&&(t.removeData(s,i),s.trigger("keyup-change"))})}function h(s){s.on("mousemove",function(s){var i=N;i!==e&&i.x===s.pageX&&i.y===s.pageY||t(s.target).trigger("mousemove-filtered",s)})}function u(t,s,i){i=i||e;var o;return function(){var e=arguments;window.clearTimeout(o),o=window.setTimeout(function(){s.apply(i,e)},t)}}function d(t,e){var s=u(t,function(t){e.trigger("scroll-debounced",t)});e.on("scroll",function(t){o(t.target,e.get())>=0&&s(t)})}function p(t){t[0]!==document.activeElement&&window.setTimeout(function(){var e,s=t[0],i=t.val().length;t.focus(),(s.offsetWidth>0||s.offsetHeight>0)&&s===document.activeElement&&(s.setSelectionRange?s.setSelectionRange(i,i):s.createTextRange&&((e=s.createTextRange()).collapse(!1),e.select()))},0)}function f(e){var s=0,i=0;if("selectionStart"in(e=t(e)[0]))s=e.selectionStart,i=e.selectionEnd-s;else if("selection"in document){e.focus();var o=document.selection.createRange();i=document.selection.createRange().text.length,o.moveStart("character",-e.value.length),s=o.text.length-i}return{offset:s,length:i}}function w(t){t.preventDefault(),t.stopPropagation()}function g(t){t.preventDefault(),t.stopImmediatePropagation()}function m(e){if(!H){var s=e[0].currentStyle||window.getComputedStyle(e[0],null);(H=t(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:s.fontSize,fontFamily:s.fontFamily,fontStyle:s.fontStyle,fontWeight:s.fontWeight,letterSpacing:s.letterSpacing,textTransform:s.textTransform,whiteSpace:"nowrap"})).attr("class","selecttwo-sizer"),t("body").append(H)}return H.text(e.val()),H.width()}function v(e,s,i){var o,n,a=[];(o=e.attr("class"))&&t((o=""+o).split(" ")).eachTwo(function(){0===this.indexOf("selecttwo-")&&a.push(this)}),(o=s.attr("class"))&&t((o=""+o).split(" ")).eachTwo(function(){0!==this.indexOf("selecttwo-")&&(n=i(this))&&a.push(n)}),e.attr("class",a.join(" "))}function b(t,e,s,o){var n=i(t.toUpperCase()).indexOf(i(e.toUpperCase())),a=e.length;n<0?s.push(o(t)):(s.push(o(t.substring(0,n))),s.push("<span class='selecttwo-match'>"),s.push(o(t.substring(n,n+a))),s.push("</span>"),s.push(o(t.substring(n+a,t.length))))}function C(t){var e={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(t).replace(/[&<>"'\/\\]/g,function(t){return e[t]})}function S(s){var i,o=null,n=s.quietMillis||100,a=s.url,c=this;return function(r){window.clearTimeout(i),i=window.setTimeout(function(){var i=s.data,n=a,l=s.transport||t.fn.selecttwo.ajaxDefaults.transport,h={type:s.type||"GET",cache:s.cache||!1,jsonpCallback:s.jsonpCallback||e,dataType:s.dataType||"json"},u=t.extend({},t.fn.selecttwo.ajaxDefaults.params,h);i=i?i.call(c,r.term,r.page,r.context):null,n="function"==typeof n?n.call(c,r.term,r.page,r.context):n,o&&"function"==typeof o.abort&&o.abort(),s.params&&(t.isFunction(s.params)?t.extend(u,s.params.call(c)):t.extend(u,s.params)),t.extend(u,{url:n,dataType:s.dataType,data:i,success:function(t){var e=s.results(t,r.page);r.callback(e)}}),o=l.call(c,u)},n)}}function y(e){var s,i,o=e,n=function(t){return""+t.text};t.isArray(o)&&(o={results:i=o}),!1===t.isFunction(o)&&(i=o,o=function(){return i});var a=o();return a.text&&(n=a.text,t.isFunction(n)||(s=a.text,n=function(t){return t[s]})),function(e){var s,i=e.term,a={results:[]};""!==i?(s=function(o,a){var c,r;if((o=o[0]).children){c={};for(r in o)o.hasOwnProperty(r)&&(c[r]=o[r]);c.children=[],t(o.children).eachTwo(function(t,e){s(e,c.children)}),(c.children.length||e.matcher(i,n(c),o))&&a.push(c)}else e.matcher(i,n(o),o)&&a.push(o)},t(o().results).eachTwo(function(t,e){s(e,a.results)}),e.callback(a)):e.callback(o())}}function T(s){var i=t.isFunction(s);return function(o){var n=o.term,a={results:[]},c=i?s(o):s;t.isArray(c)&&(t(c).each(function(){var t=this.text!==e,s=t?this.text:this;(""===n||o.matcher(n,s))&&a.results.push(t?this:{id:this,text:this})}),o.callback(a))}}function E(e,s){if(t.isFunction(e))return!0;if(!e)return!1;if("string"==typeof e)return!0;throw new Error(s+" must be a string, function, or falsy value")}function x(e){if(t.isFunction(e)){var s=Array.prototype.slice.call(arguments,1);return e.apply(null,s)}return e}function O(e){var s=0;return t.each(e,function(t,e){e.children?s+=O(e.children):s++}),s}function I(){var t=this;Array.prototype.forEach.call(arguments,function(e){t[e].remove(),t[e]=null})}function P(e,s){var i=function(){};return i.prototype=new e,i.prototype.constructor=i,i.prototype.parent=e.prototype,i.prototype=t.extend(i.prototype,s),i}if(window.SelectTwo===e){var k,A,R,D,H,L,M,N={x:0,y:0},U={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(t){switch(t=t.which?t.which:t){case U.LEFT:case U.RIGHT:case U.UP:case U.DOWN:return!0}return!1},isControl:function(t){switch(t.which){case U.SHIFT:case U.CTRL:case U.ALT:return!0}return!!t.metaKey},isFunctionKey:function(t){return(t=t.which?t.which:t)>=112&&t<=123}},F="<div class='selecttwo-measure-scrollbar'></div>",z={"?":"A","A":"A","À":"A","Á":"A","Â":"A","?":"A","?":"A","?":"A","?":"A","Ã":"A","A":"A","A":"A","?":"A","?":"A","?":"A","?":"A","?":"A","?":"A","Ä":"A","A":"A","?":"A","Å":"A","?":"A","A":"A","?":"A","?":"A","?":"A","?":"A","?":"A","?":"A","A":"A","?":"A","?":"A","?":"AA","Æ":"AE","?":"AE","?":"AE","?":"AO","?":"AU","?":"AV","?":"AV","?":"AY","?":"B","B":"B","?":"B","?":"B","?":"B","?":"B","?":"B","?":"B","?":"C","C":"C","C":"C","C":"C","C":"C","C":"C","Ç":"C","?":"C","?":"C","?":"C","?":"C","?":"D","D":"D","?":"D","D":"D","?":"D","?":"D","?":"D","?":"D","Ð":"D","?":"D","?":"D","Ð":"D","?":"D","?":"DZ","?":"DZ","?":"Dz","?":"Dz","?":"E","E":"E","È":"E","É":"E","Ê":"E","?":"E","?":"E","?":"E","?":"E","?":"E","E":"E","?":"E","?":"E","E":"E","E":"E","Ë":"E","?":"E","E":"E","?":"E","?":"E","?":"E","?":"E","?":"E","?":"E","E":"E","?":"E","?":"E","?":"E","?":"E","?":"F","F":"F","?":"F","ƒ":"F","?":"F","?":"G","G":"G","?":"G","G":"G","?":"G","G":"G","G":"G","G":"G","G":"G","G":"G","?":"G","?":"G","?":"G","?":"G","?":"H","H":"H","H":"H","?":"H","?":"H","?":"H","?":"H","?":"H","?":"H","H":"H","?":"H","?":"H","?":"H","?":"I","I":"I","Ì":"I","Í":"I","Î":"I","I":"I","I":"I","I":"I","I":"I","Ï":"I","?":"I","?":"I","I":"I","?":"I","?":"I","?":"I","I":"I","?":"I","I":"I","?":"J","J":"J","J":"J","?":"J","?":"K","K":"K","?":"K","K":"K","?":"K","K":"K","?":"K","?":"K","?":"K","?":"K","?":"K","?":"K","?":"K","?":"L","L":"L","?":"L","L":"L","L":"L","?":"L","?":"L","L":"L","?":"L","?":"L","L":"L","?":"L","?":"L","?":"L","?":"L","?":"L","?":"L","?":"LJ","?":"Lj","?":"M","M":"M","?":"M","?":"M","?":"M","?":"M","?":"M","?":"N","N":"N","?":"N","N":"N","Ñ":"N","?":"N","N":"N","?":"N","N":"N","?":"N","?":"N","?":"N","?":"N","?":"N","?":"N","?":"NJ","?":"Nj","?":"O","O":"O","Ò":"O","Ó":"O","Ô":"O","?":"O","?":"O","?":"O","?":"O","Õ":"O","?":"O","?":"O","?":"O","O":"O","?":"O","?":"O","O":"O","?":"O","?":"O","Ö":"O","?":"O","?":"O","O":"O","O":"O","?":"O","?":"O","O":"O","?":"O","?":"O","?":"O","?":"O","?":"O","?":"O","?":"O","O":"O","O":"O","Ø":"O","?":"O","?":"O","O":"O","?":"O","?":"O","?":"OI","?":"OO","?":"OU","?":"P","P":"P","?":"P","?":"P","?":"P","?":"P","?":"P","?":"P","?":"P","?":"Q","Q":"Q","?":"Q","?":"Q","?":"Q","?":"R","R":"R","R":"R","?":"R","R":"R","?":"R","?":"R","?":"R","?":"R","R":"R","?":"R","?":"R","?":"R","?":"R","?":"R","?":"R","?":"S","S":"S","?":"S","S":"S","?":"S","S":"S","?":"S","Š":"S","?":"S","?":"S","?":"S","?":"S","S":"S","?":"S","?":"S","?":"S","?":"T","T":"T","?":"T","T":"T","?":"T","?":"T","T":"T","?":"T","?":"T","T":"T","?":"T","T":"T","?":"T","?":"T","?":"TZ","?":"U","U":"U","Ù":"U","Ú":"U","Û":"U","U":"U","?":"U","U":"U","?":"U","U":"U","Ü":"U","U":"U","U":"U","U":"U","U":"U","?":"U","U":"U","U":"U","U":"U","?":"U","?":"U","U":"U","?":"U","?":"U","?":"U","?":"U","?":"U","?":"U","?":"U","U":"U","?":"U","?":"U","?":"U","?":"V","V":"V","?":"V","?":"V","?":"V","?":"V","?":"V","?":"VY","?":"W","W":"W","?":"W","?":"W","W":"W","?":"W","?":"W","?":"W","?":"W","?":"X","X":"X","?":"X","?":"X","?":"Y","Y":"Y","?":"Y","Ý":"Y","Y":"Y","?":"Y","?":"Y","?":"Y","Ÿ":"Y","?":"Y","?":"Y","?":"Y","?":"Y","?":"Y","?":"Z","Z":"Z","Z":"Z","?":"Z","Z":"Z","Ž":"Z","?":"Z","?":"Z","?":"Z","?":"Z","?":"Z","?":"Z","?":"Z","?":"a","a":"a","?":"a","à":"a","á":"a","â":"a","?":"a","?":"a","?":"a","?":"a","ã":"a","a":"a","a":"a","?":"a","?":"a","?":"a","?":"a","?":"a","?":"a","ä":"a","a":"a","?":"a","å":"a","?":"a","a":"a","?":"a","?":"a","?":"a","?":"a","?":"a","?":"a","a":"a","?":"a","?":"a","?":"aa","æ":"ae","?":"ae","?":"ae","?":"ao","?":"au","?":"av","?":"av","?":"ay","?":"b","b":"b","?":"b","?":"b","?":"b","b":"b","?":"b","?":"b","?":"c","c":"c","c":"c","c":"c","c":"c","c":"c","ç":"c","?":"c","?":"c","?":"c","?":"c","?":"c","?":"d","d":"d","?":"d","d":"d","?":"d","?":"d","?":"d","?":"d","d":"d","?":"d","?":"d","?":"d","?":"d","?":"dz","?":"dz","?":"e","e":"e","è":"e","é":"e","ê":"e","?":"e","?":"e","?":"e","?":"e","?":"e","e":"e","?":"e","?":"e","e":"e","e":"e","ë":"e","?":"e","e":"e","?":"e","?":"e","?":"e","?":"e","?":"e","?":"e","e":"e","?":"e","?":"e","?":"e","?":"e","?":"e","?":"f","f":"f","?":"f","ƒ":"f","?":"f","?":"g","g":"g","?":"g","g":"g","?":"g","g":"g","g":"g","g":"g","g":"g","g":"g","?":"g","?":"g","?":"g","?":"g","?":"h","h":"h","h":"h","?":"h","?":"h","?":"h","?":"h","?":"h","?":"h","?":"h","h":"h","?":"h","?":"h","?":"h","?":"hv","?":"i","i":"i","ì":"i","í":"i","î":"i","i":"i","i":"i","i":"i","ï":"i","?":"i","?":"i","i":"i","?":"i","?":"i","?":"i","i":"i","?":"i","?":"i","i":"i","?":"j","j":"j","j":"j","j":"j","?":"j","?":"k","k":"k","?":"k","k":"k","?":"k","k":"k","?":"k","?":"k","?":"k","?":"k","?":"k","?":"k","?":"k","?":"l","l":"l","?":"l","l":"l","l":"l","?":"l","?":"l","l":"l","?":"l","?":"l","?":"l","l":"l","l":"l","?":"l","?":"l","?":"l","?":"l","?":"l","?":"lj","?":"m","m":"m","?":"m","?":"m","?":"m","?":"m","?":"m","?":"n","n":"n","?":"n","n":"n","ñ":"n","?":"n","n":"n","?":"n","n":"n","?":"n","?":"n","?":"n","?":"n","?":"n","?":"n","?":"n","?":"nj","?":"o","o":"o","ò":"o","ó":"o","ô":"o","?":"o","?":"o","?":"o","?":"o","õ":"o","?":"o","?":"o","?":"o","o":"o","?":"o","?":"o","o":"o","?":"o","?":"o","ö":"o","?":"o","?":"o","o":"o","o":"o","?":"o","?":"o","o":"o","?":"o","?":"o","?":"o","?":"o","?":"o","?":"o","?":"o","o":"o","o":"o","ø":"o","?":"o","?":"o","?":"o","?":"o","?":"o","?":"oi","?":"ou","?":"oo","?":"p","p":"p","?":"p","?":"p","?":"p","?":"p","?":"p","?":"p","?":"p","?":"q","q":"q","?":"q","?":"q","?":"q","?":"r","r":"r","r":"r","?":"r","r":"r","?":"r","?":"r","?":"r","?":"r","r":"r","?":"r","?":"r","?":"r","?":"r","?":"r","?":"r","?":"s","s":"s","ß":"s","s":"s","?":"s","s":"s","?":"s","š":"s","?":"s","?":"s","?":"s","?":"s","s":"s","?":"s","?":"s","?":"s","?":"s","?":"t","t":"t","?":"t","?":"t","t":"t","?":"t","?":"t","t":"t","?":"t","?":"t","t":"t","?":"t","?":"t","?":"t","?":"t","?":"tz","?":"u","u":"u","ù":"u","ú":"u","û":"u","u":"u","?":"u","u":"u","?":"u","u":"u","ü":"u","u":"u","u":"u","u":"u","u":"u","?":"u","u":"u","u":"u","u":"u","?":"u","?":"u","u":"u","?":"u","?":"u","?":"u","?":"u","?":"u","?":"u","?":"u","u":"u","?":"u","?":"u","?":"u","?":"v","v":"v","?":"v","?":"v","?":"v","?":"v","?":"v","?":"vy","?":"w","w":"w","?":"w","?":"w","w":"w","?":"w","?":"w","?":"w","?":"w","?":"w","?":"x","x":"x","?":"x","?":"x","?":"y","y":"y","?":"y","ý":"y","y":"y","?":"y","?":"y","?":"y","ÿ":"y","?":"y","?":"y","?":"y","?":"y","?":"y","?":"y","?":"z","z":"z","z":"z","?":"z","z":"z","ž":"z","?":"z","?":"z","z":"z","?":"z","?":"z","?":"z","?":"z"};L=t(document),D=function(){var t=1;return function(){return t++}}(),L.on("mousemove",function(t){N.x=t.pageX,N.y=t.pageY}),A=P(k=P(Object,{bind:function(t){var e=this;return function(){t.apply(e,arguments)}},init:function(s){var i,o;this.opts=s=this.prepareOpts(s),this.id=s.id,s.element.data("selecttwo")!==e&&null!==s.element.data("selecttwo")&&s.element.data("selecttwo").destroy(),this.container=this.createContainer(),this.containerId="sTwoID_"+(s.element.attr("id")||"autogen"+D()),this.containerEventName=this.containerId.replace(/([.])/g,"_").replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.container.attr("title",s.element.attr("title")),this.body=t("body"),v(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",s.element.attr("style")),this.container.css(x(s.containerCss)),this.container.addClass(x(s.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("selecttwo",this).attr("tabindex","-1").before(this.container).on("click.selecttwo",w),this.container.data("selecttwo",this),this.dropdown=this.container.find(".selecttwo-drop"),v(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(x(s.dropdownCssClass)),this.dropdown.data("selecttwo",this),this.dropdown.on("click",w),this.results=i=this.container.find(".selecttwo-results"),this.search=o=this.container.find("input.selecttwo-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",w),h(this.results),this.dropdown.on("mousemove-filtered",".selecttwo-results",this.bind(this.highlightUnderEvent)),this.dropdown.on("touchstart touchmove touchend",".selecttwo-results",this.bind(function(t){this._touchEvent=!0,this.highlightUnderEvent(t)})),this.dropdown.on("touchmove",".selecttwo-results",this.bind(this.touchMoved)),this.dropdown.on("touchstart touchend",".selecttwo-results",this.bind(this.clearTouchMoved)),this.dropdown.on("click",this.bind(function(t){this._touchEvent&&(this._touchEvent=!1,this.selectHighlighted())})),d(80,this.results),this.dropdown.on("scroll-debounced",".selecttwo-results",this.bind(this.loadMoreIfNeeded)),t(this.container).on("change",".selecttwo-input",function(t){t.stopPropagation()}),t(this.dropdown).on("change",".selecttwo-input",function(t){t.stopPropagation()}),t.fn.mousewheel&&i.mousewheel(function(t,e,s,o){var n=i.scrollTop();o>0&&n-o<=0?(i.scrollTop(0),w(t)):o<0&&i.get(0).scrollHeight-i.scrollTop()+o<=i.height()&&(i.scrollTop(i.get(0).scrollHeight-i.height()),w(t))}),l(o),o.on("keyup-change input paste",this.bind(this.updateResults)),o.on("focus",function(){o.addClass("selecttwo-focused")}),o.on("blur",function(){o.removeClass("selecttwo-focused")}),this.dropdown.on("mouseup",".selecttwo-results",this.bind(function(e){t(e.target).closest(".selecttwo-result-selectable").length>0&&(this.highlightUnderEvent(e),this.selectHighlighted(e))})),this.dropdown.on("click mouseup mousedown touchstart touchend focusin",function(t){t.stopPropagation()}),this.nextSearchTerm=e,t.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==s.maximumInputLength&&this.search.attr("maxlength",s.maximumInputLength);var a=s.element.prop("disabled");a===e&&(a=!1),this.enable(!a);var c=s.element.prop("readonly");c===e&&(c=!1),this.readonly(c),M=M||n(),this.autofocus=s.element.prop("autofocus"),s.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.search.attr("placeholder",s.searchInputPlaceholder)},destroy:function(){var t=this.opts.element,s=t.data("selecttwo");this.close(),this.propertyObserver&&(this.propertyObserver.disconnect(),this.propertyObserver=null),s!==e&&(s.container.remove(),s.dropdown.remove(),t.removeClass("selecttwo-offscreen").removeData("selecttwo").off(".selecttwo").prop("autofocus",this.autofocus||!1),this.elementTabIndex?t.attr({tabindex:this.elementTabIndex}):t.removeAttr("tabindex"),t.show()),I.call(this,"container","dropdown","results","search")},optionToData:function(t){return t.is("option")?{id:t.prop("value"),text:t.text(),element:t.get(),css:t.attr("class"),disabled:t.prop("disabled"),locked:a(t.attr("locked"),"locked")||a(t.data("locked"),!0)}:t.is("optgroup")?{text:t.attr("label"),children:[],element:t.get(),css:t.attr("class")}:void 0},prepareOpts:function(s){var i,o,n,r,l=this;if("select"===(i=s.element).get(0).tagName.toLowerCase()&&(this.select=o=s.element),o&&t.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in s)throw new Error("Option '"+this+"' is not allowed for SelectTwo when attached to a <select> element.")}),"function"!=typeof(s=t.extend({},{populateResults:function(i,o,n){var a,c=this.opts.id;(a=function(i,o,r){var h,u,d,p,f,w,g,m,v,b;for(h=0,u=(i=s.sortResults(i,o,n)).length;h<u;h+=1)p=!(f=!0===(d=i[h]).disabled)&&c(d)!==e,w=d.children&&d.children.length>0,(g=t("<li></li>")).addClass("selecttwo-results-dept-"+r),g.addClass("selecttwo-result"),g.addClass(p?"selecttwo-result-selectable":"selecttwo-result-unselectable"),f&&g.addClass("selecttwo-disabled"),w&&g.addClass("selecttwo-result-with-children"),g.addClass(l.opts.formatResultCssClass(d)),g.attr("role","presentation"),(m=t(document.createElement("div"))).addClass("selecttwo-result-label"),m.attr("id","selecttwo-result-label-"+D()),m.attr("role","option"),(b=s.formatResult(d,m,n,l.opts.escapeMarkup))!==e&&(m.html(b),g.append(m)),w&&((v=t("<ul></ul>")).addClass("selecttwo-result-sub"),a(d.children,v,r+1),g.append(v)),g.data("selecttwo-data",d),o.append(g)})(o,i,0)}},t.fn.selecttwo.defaults,s)).id&&(n=s.id,s.id=function(t){return t[n]}),t.isArray(s.element.data("selecttwoTags"))){if("tags"in s)throw"tags specified as both an attribute 'data-selecttwo-tags' and in options of SelectTwo "+s.element.attr("id");s.tags=s.element.data("selecttwoTags")}if(o?(s.query=this.bind(function(t){var s,o,n,a={results:[],more:!1},c=t.term;n=function(e,s){var i;e.is("option")?t.matcher(c,e.text(),e)&&s.push(l.optionToData(e)):e.is("optgroup")&&(i=l.optionToData(e),e.children().eachTwo(function(t,e){n(e,i.children)}),i.children.length>0&&s.push(i))},s=i.children(),this.getPlaceholder()!==e&&s.length>0&&(o=this.getPlaceholderOption())&&(s=s.not(o)),s.eachTwo(function(t,e){n(e,a.results)}),t.callback(a)}),s.id=function(t){return t.id}):"query"in s||("ajax"in s?((r=s.element.data("ajax-url"))&&r.length>0&&(s.ajax.url=r),s.query=S.call(s.element,s.ajax)):"data"in s?s.query=y(s.data):"tags"in s&&(s.query=T(s.tags),s.createSearchChoice===e&&(s.createSearchChoice=function(e){return{id:t.trim(e),text:t.trim(e)}}),s.initSelection===e&&(s.initSelection=function(e,i){var o=[];t(c(e.val(),s.separator)).each(function(){var e={id:this,text:this},i=s.tags;t.isFunction(i)&&(i=i()),t(i).each(function(){if(a(this.id,e.id))return e=this,!1}),o.push(e)}),i(o)}))),"function"!=typeof s.query)throw"query function not defined for SelectTwo "+s.element.attr("id");if("top"===s.createSearchChoicePosition)s.createSearchChoicePosition=function(t,e){t.unshift(e)};else if("bottom"===s.createSearchChoicePosition)s.createSearchChoicePosition=function(t,e){t.push(e)};else if("function"!=typeof s.createSearchChoicePosition)throw"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";return s},monitorSource:function(){var t,s,i=this.opts.element;i.on("change.selecttwo",this.bind(function(t){!0!==this.opts.element.data("selecttwo-change-triggered")&&this.initSelection()})),t=this.bind(function(){var t=i.prop("disabled");t===e&&(t=!1),this.enable(!t);var s=i.prop("readonly");s===e&&(s=!1),this.readonly(s),v(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(x(this.opts.containerCssClass)),v(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(x(this.opts.dropdownCssClass))}),i.length&&i[0].attachEvent&&i.each(function(){this.attachEvent("onpropertychange",t)}),(s=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)!==e&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new s(function(e){e.forEach(t)}),this.propertyObserver.observe(i.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(e){var s=t.Event("selecttwo-selecting",{val:this.id(e),object:e});return this.opts.element.trigger(s),!s.isDefaultPrevented()},triggerChange:function(e){e=e||{},e=t.extend({},e,{type:"change",val:this.val()}),this.opts.element.data("selecttwo-change-triggered",!0),this.opts.element.trigger(e),this.opts.element.data("selecttwo-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return!0===this.enabledInterface},enableInterface:function(){var t=this._enabled&&!this._readonly,e=!t;return t!==this.enabledInterface&&(this.container.toggleClass("selecttwo-container-disabled",e),this.close(),this.enabledInterface=t,!0)},enable:function(t){t===e&&(t=!0),this._enabled!==t&&(this._enabled=t,this.opts.element.prop("disabled",!t),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(t){t===e&&(t=!1),this._readonly!==t&&(this._readonly=t,this.opts.element.prop("readonly",t),this.enableInterface())},opened:function(){return this.container.hasClass("selecttwo-dropdown-open")},positionDropdown:function(){var e,s,i,o,n,a=this.dropdown,c=this.container.offset(),r=this.container.outerHeight(!1),l=this.container.outerWidth(!1),h=a.outerHeight(!1),u=t(window),d=u.width(),p=u.height(),f=u.scrollLeft()+d,w=u.scrollTop()+p,g=c.top+r,m=c.left,v=g+h<=w,b=c.top-h>=u.scrollTop(),C=a.outerWidth(!1),S=m+C<=f;a.hasClass("selecttwo-drop-above")?(s=!0,!b&&v&&(i=!0,s=!1)):(s=!1,!v&&b&&(i=!0,s=!0)),i&&(a.hide(),c=this.container.offset(),r=this.container.outerHeight(!1),l=this.container.outerWidth(!1),h=a.outerHeight(!1),f=u.scrollLeft()+d,w=u.scrollTop()+p,g=c.top+r,S=(m=c.left)+(C=a.outerWidth(!1))<=f,a.show(),this.focusSearch()),this.opts.dropdownAutoWidth?(n=t(".selecttwo-results",a)[0],a.addClass("selecttwo-drop-auto-width"),a.css("width",""),(C=a.outerWidth(!1)+(n.scrollHeight===n.clientHeight?0:M.width))>l?l=C:C=l,h=a.outerHeight(!1),S=m+C<=f):this.container.removeClass("selecttwo-drop-auto-width"),"static"!==this.body.css("position")&&(g-=(e=this.body.offset()).top,m-=e.left),S||(m=c.left+this.container.outerWidth(!1)-C),o={left:m,width:l},s?(o.top=c.top-h,o.bottom="auto",this.container.addClass("selecttwo-drop-above"),a.addClass("selecttwo-drop-above")):(o.top=g,o.bottom="auto",this.container.removeClass("selecttwo-drop-above"),a.removeClass("selecttwo-drop-above")),o=t.extend(o,x(this.opts.dropdownCss)),a.css(o)},shouldOpen:function(){var e;return!this.opened()&&(!1!==this._enabled&&!0!==this._readonly&&(e=t.Event("selecttwo-opening"),this.opts.element.trigger(e),!e.isDefaultPrevented()))},clearDropdownAlignmentPreference:function(){this.container.removeClass("selecttwo-drop-above"),this.dropdown.removeClass("selecttwo-drop-above")},open:function(){return!!this.shouldOpen()&&(this.opening(),!0)},opening:function(){var e,i=this.containerEventName,o="scroll."+i,n="resize."+i,a="orientationchange."+i;this.container.addClass("selecttwo-dropdown-open").addClass("selecttwo-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body.children().last()[0]&&this.dropdown.detach().appendTo(this.body),0==(e=t("#selecttwo-drop-mask")).length&&((e=t(document.createElement("div"))).attr("id","selecttwo-drop-mask").attr("class","selecttwo-drop-mask"),e.hide(),e.appendTo(this.body),e.on("mousedown touchstart click",function(i){s(e);var o,n=t("#selecttwo-drop");n.length>0&&((o=n.data("selecttwo")).opts.selectOnBlur&&o.selectHighlighted({noFocus:!0}),o.close(),i.preventDefault(),i.stopPropagation())})),this.dropdown.prev()[0]!==e[0]&&this.dropdown.before(e),t("#selecttwo-drop").removeAttr("id"),this.dropdown.attr("id","selecttwo-drop"),e.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("selecttwo-drop-active");var c=this;this.container.parents().add(window).each(function(){t(this).on(n+" "+o+" "+a,function(t){c.opened()&&c.positionDropdown()})})},close:function(){if(this.opened()){var e=this.containerEventName,s="scroll."+e,i="resize."+e,o="orientationchange."+e;this.container.parents().add(window).each(function(){t(this).off(s).off(i).off(o)}),this.clearDropdownAlignmentPreference(),t("#selecttwo-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("selecttwo-dropdown-open").removeClass("selecttwo-container-active"),this.results.empty(),this.clearSearch(),this.search.removeClass("selecttwo-active"),this.opts.element.trigger(t.Event("selecttwo-close"))}},externalSearch:function(t){this.open(),this.search.val(t),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return x(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var e,s,i,o,n,a,c,r=this.results;(s=this.highlight())<0||(0!=s?(e=this.findHighlightableChoices().find(".selecttwo-result-label"),o=(i=t(e[s])).offset().top+i.outerHeight(!0),s===e.length-1&&(c=r.find("li.selecttwo-more-results")).length>0&&(o=c.offset().top+c.outerHeight(!0)),o>(n=r.offset().top+r.outerHeight(!0))&&r.scrollTop(r.scrollTop()+(o-n)),(a=i.offset().top-r.offset().top)<0&&"none"!=i.css("display")&&r.scrollTop(r.scrollTop()+a)):r.scrollTop(0))},findHighlightableChoices:function(){return this.results.find(".selecttwo-result-selectable:not(.selecttwo-disabled):not(.selecttwo-selected)")},moveHighlight:function(e){for(var s=this.findHighlightableChoices(),i=this.highlight();i>-1&&i<s.length;){var o=t(s[i+=e]);if(o.hasClass("selecttwo-result-selectable")&&!o.hasClass("selecttwo-disabled")&&!o.hasClass("selecttwo-selected")){this.highlight(i);break}}},highlight:function(e){var s,i,n=this.findHighlightableChoices();if(0===arguments.length)return o(n.filter(".selecttwo-highlighted")[0],n.get());e>=n.length&&(e=n.length-1),e<0&&(e=0),this.removeHighlight(),(s=t(n[e])).addClass("selecttwo-highlighted"),this.search.attr("aria-activedescendant",s.find(".selecttwo-result-label").attr("id")),this.ensureHighlightVisible(),(i=s.data("selecttwo-data"))&&this.opts.element.trigger({type:"selecttwo-highlight",val:this.id(i),choice:i})},removeHighlight:function(){this.results.find(".selecttwo-highlighted").removeClass("selecttwo-highlighted")},touchMoved:function(){this._touchMoved=!0},clearTouchMoved:function(){this._touchMoved=!1},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(e){var s=t(e.target).closest(".selecttwo-result-selectable");if(s.length>0&&!s.is(".selecttwo-highlighted")){var i=this.findHighlightableChoices();this.highlight(i.index(s))}else 0==s.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var t=this.results,e=t.find("li.selecttwo-more-results"),s=this.resultsPage+1,i=this,o=this.search.val(),n=this.context;0!==e.length&&e.offset().top-t.offset().top-t.height()<=this.opts.loadMorePadding&&(e.addClass("selecttwo-active"),this.opts.query({element:this.opts.element,term:o,page:s,context:n,matcher:this.opts.matcher,callback:this.bind(function(a){i.opened()&&(i.opts.populateResults.call(this,t,a.results,{term:o,page:s,context:n}),i.postprocessResults(a,!1,!1),!0===a.more?(e.detach().appendTo(t).text(x(i.opts.formatLoadMore,s+1)),window.setTimeout(function(){i.loadMoreIfNeeded()},10)):e.remove(),i.positionDropdown(),i.resultsPage=s,i.context=a.context,this.opts.element.trigger({type:"selecttwo-loaded",items:a}))})}))},tokenize:function(){},updateResults:function(s){function i(){l.removeClass("selecttwo-active"),d.positionDropdown(),h.find(".selecttwo-no-results,.selecttwo-selection-limit,.selecttwo-searching").length}function o(t){h.html(t),i()}var n,c,r,l=this.search,h=this.results,u=this.opts,d=this,p=l.val(),f=t.data(this.container,"selecttwo-last-term");if((!0===s||!f||!a(p,f))&&(t.data(this.container,"selecttwo-last-term",p),!0===s||!1!==this.showSearchInput&&this.opened())){r=++this.queryCount;var w=this.getMaximumSelectionSize();if(!(w>=1&&(n=this.data(),t.isArray(n)&&n.length>=w&&E(u.formatSelectionTooBig,"formatSelectionTooBig"))))return l.val().length<u.minimumInputLength?(o(E(u.formatInputTooShort,"formatInputTooShort")?"<li class='selecttwo-no-results'>"+x(u.formatInputTooShort,l.val(),u.minimumInputLength)+"</li>":""),void(s&&this.showSearch&&this.showSearch(!0))):void(u.maximumInputLength&&l.val().length>u.maximumInputLength?o(E(u.formatInputTooLong,"formatInputTooLong")?"<li class='selecttwo-no-results'>"+x(u.formatInputTooLong,l.val(),u.maximumInputLength)+"</li>":""):(u.formatSearching&&0===this.findHighlightableChoices().length&&o("<li class='selecttwo-searching'>"+x(u.formatSearching)+"</li>"),l.addClass("selecttwo-active"),this.removeHighlight(),(c=this.tokenize())!=e&&null!=c&&l.val(c),this.resultsPage=1,u.query({element:u.element,term:l.val(),page:this.resultsPage,context:null,matcher:u.matcher,callback:this.bind(function(n){var c;r==this.queryCount&&(this.opened()?(this.context=n.context===e?null:n.context,this.opts.createSearchChoice&&""!==l.val()&&(c=this.opts.createSearchChoice.call(d,l.val(),n.results))!==e&&null!==c&&d.id(c)!==e&&null!==d.id(c)&&0===t(n.results).filter(function(){return a(d.id(this),d.id(c))}).length&&this.opts.createSearchChoicePosition(n.results,c),0===n.results.length&&E(u.formatNoMatches,"formatNoMatches")?o("<li class='selecttwo-no-results'>"+x(u.formatNoMatches,l.val())+"</li>"):(h.empty(),d.opts.populateResults.call(this,h,n.results,{term:l.val(),page:this.resultsPage,context:null}),!0===n.more&&E(u.formatLoadMore,"formatLoadMore")&&(h.append("<li class='selecttwo-more-results'>"+d.opts.escapeMarkup(x(u.formatLoadMore,this.resultsPage))+"</li>"),window.setTimeout(function(){d.loadMoreIfNeeded()},10)),this.postprocessResults(n,s),i(),this.opts.element.trigger({type:"selecttwo-loaded",items:n}))):this.search.removeClass("selecttwo-active"))})})));o("<li class='selecttwo-selection-limit'>"+x(u.formatSelectionTooBig,w)+"</li>")}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("selecttwo-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".selecttwo-search-choice-focus").removeClass("selecttwo-search-choice-focus")},focusSearch:function(){p(this.search)},selectHighlighted:function(t){if(this._touchMoved)this.clearTouchMoved();else{var e=this.highlight(),s=this.results.find(".selecttwo-highlighted").closest(".selecttwo-result").data("selecttwo-data");s?(this.highlight(e),this.onSelect(s,t)):t&&t.noFocus&&this.close()}},getPlaceholder:function(){var t;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((t=this.getPlaceholderOption())!==e?t.text():e)},getPlaceholderOption:function(){if(this.select){var s=this.select.children("option").first();if(this.opts.placeholderOption!==e)return"first"===this.opts.placeholderOption&&s||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===t.trim(s.text())&&""===s.val())return s}},initContainerWidth:function(){var s=function(){var s,i,o,n,a,c;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if((s=this.opts.element.attr("style"))!==e)for(n=0,a=(i=s.split(";")).length;n<a;n+=1)if(c=i[n].replace(/\s/g,""),null!==(o=c.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i))&&o.length>=1)return o[1];return"resolve"===this.opts.width?(s=this.opts.element.css("width"),s.indexOf("%")>0?s:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return t.isFunction(this.opts.width)?this.opts.width():this.opts.width}.call(this);null!==s&&this.container.css("width",s)}}),{createContainer:function(){return t(document.createElement("div")).attr({class:"selecttwo-container"}).html(["<a href='javascript:void(0)' class='selecttwo-choice' tabindex='-1'>","   <span class='selecttwo-chosen'>&#160;</span><abbr class='selecttwo-search-choice-close'></abbr>","   <span class='selecttwo-arrow' role='presentation'><b role='presentation'></b></span>","</a>","<label for='' class='selecttwo-offscreen'></label>","<input class='selecttwo-focusser selecttwo-offscreen' type='text' aria-haspopup='true' role='button' />","<div class='selecttwo-drop selecttwo-display-none'>","   <div class='selecttwo-search'>","       <label for='' class='selecttwo-offscreen'></label>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='selecttwo-input' role='combobox' aria-expanded='true'","       aria-autocomplete='list' />","   </div>","   <ul class='selecttwo-results' role='listbox'>","   </ul>","</div>"].join(""))},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var s,i,o;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),!1!==this.showSearchInput&&this.search.val(this.focusser.val()),this.opts.shouldFocusInput(this)&&(this.search.focus(),(s=this.search.get(0)).createTextRange?((i=s.createTextRange()).collapse(!1),i.select()):s.setSelectionRange&&(o=this.search.val().length,s.setSelectionRange(o,o))),""===this.search.val()&&this.nextSearchTerm!=e&&(this.search.val(this.nextSearchTerm),this.search.select()),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(t.Event("selecttwo-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},isFocused:function(){return this.container.hasClass("selecttwo-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus()},destroy:function(){t("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),I.call(this,"selection","focusser")},initContainer:function(){var e,i,o=this.container,n=this.dropdown,a=D();this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=e=o.find(".selecttwo-choice"),this.focusser=o.find(".selecttwo-focusser"),e.find(".selecttwo-chosen").attr("id","selecttwo-chosen-"+a),this.focusser.attr("aria-labelledby","selecttwo-chosen-"+a),this.results.attr("id","selecttwo-results-"+a),this.search.attr("aria-owns","selecttwo-results-"+a),this.focusser.attr("id","sTwoID_autogen"+a),i=t("label[for='"+this.opts.element.attr("id")+"']"),this.focusser.prev().text(i.text()).attr("for",this.focusser.attr("id"));var c=this.opts.element.attr("title");this.opts.element.attr("title",c||i.text()),this.focusser.attr("tabindex",this.elementTabIndex),this.search.attr("id",this.focusser.attr("id")+"_search"),this.search.prev().text(t("label[for='"+this.focusser.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("keydown",this.bind(function(t){if(this.isInterfaceEnabled())if(t.which!==U.PAGE_UP&&t.which!==U.PAGE_DOWN)switch(t.which){case U.UP:case U.DOWN:return this.moveHighlight(t.which===U.UP?-1:1),void w(t);case U.ENTER:return this.selectHighlighted(),void w(t);case U.TAB:return void this.selectHighlighted({noFocus:!0});case U.ESC:return this.cancel(t),void w(t)}else w(t)})),this.search.on("blur",this.bind(function(t){document.activeElement===this.body.get(0)&&window.setTimeout(this.bind(function(){this.opened()&&this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(t){if(this.isInterfaceEnabled()&&t.which!==U.TAB&&!U.isControl(t)&&!U.isFunctionKey(t)&&t.which!==U.ESC){if(!1!==this.opts.openOnEnter||t.which!==U.ENTER){if(t.which==U.DOWN||t.which==U.UP||t.which==U.ENTER&&this.opts.openOnEnter){if(t.altKey||t.ctrlKey||t.shiftKey||t.metaKey)return;return this.open(),void w(t)}return t.which==U.DELETE||t.which==U.BACKSPACE?(this.opts.allowClear&&this.clear(),void w(t)):void 0}w(t)}})),l(this.focusser),this.focusser.on("keyup-change input",this.bind(function(t){if(this.opts.minimumResultsForSearch>=0){if(t.stopPropagation(),this.opened())return;this.open()}})),e.on("mousedown touchstart","abbr",this.bind(function(t){this.isInterfaceEnabled()&&(this.clear(),g(t),this.close(),this.selection.focus())})),e.on("mousedown touchstart",this.bind(function(i){s(e),this.container.hasClass("selecttwo-container-active")||this.opts.element.trigger(t.Event("selecttwo-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),w(i)})),n.on("mousedown touchstart",this.bind(function(){this.opts.shouldFocusInput(this)&&this.search.focus()})),e.on("focus",this.bind(function(t){w(t)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("selecttwo-container-active")||this.opts.element.trigger(t.Event("selecttwo-focus")),this.container.addClass("selecttwo-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("selecttwo-container-active"),this.opts.element.trigger(t.Event("selecttwo-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("selecttwo-container-active")||this.opts.element.trigger(t.Event("selecttwo-focus")),this.container.addClass("selecttwo-container-active")})),this.initContainerWidth(),this.opts.element.addClass("selecttwo-offscreen"),this.setPlaceholder()},clear:function(e){var s=this.selection.data("selecttwo-data");if(s){var i=t.Event("selecttwo-clearing");if(this.opts.element.trigger(i),i.isDefaultPrevented())return;var o=this.getPlaceholderOption();this.opts.element.val(o?o.val():""),this.selection.find(".selecttwo-chosen").empty(),this.selection.removeData("selecttwo-data"),this.setPlaceholder(),!1!==e&&(this.opts.element.trigger({type:"selecttwo-removed",val:this.id(s),choice:s}),this.triggerChange({removed:s}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var t=this;this.opts.initSelection.call(null,this.opts.element,function(s){s!==e&&null!==s&&(t.updateSelection(s),t.close(),t.setPlaceholder(),t.nextSearchTerm=t.opts.nextSearchTerm(s,t.search.val()))})}},isPlaceholderOptionSelected:function(){var t;return this.getPlaceholder()!==e&&((t=this.getPlaceholderOption())!==e&&t.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===e||null===this.opts.element.val())},prepareOpts:function(){var e=this.parent.prepareOpts.apply(this,arguments),s=this;return"select"===e.element.get(0).tagName.toLowerCase()?e.initSelection=function(t,e){var i=t.find("option").filter(function(){return this.selected&&!this.disabled});e(s.optionToData(i))}:"data"in e&&(e.initSelection=e.initSelection||function(s,i){var o=s.val(),n=null;e.query({matcher:function(t,s,i){var c=a(o,e.id(i));return c&&(n=i),c},callback:t.isFunction(i)?function(){i(n)}:t.noop})}),e},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===e?e:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var t=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&t!==e){if(this.select&&this.getPlaceholderOption()===e)return;this.selection.find(".selecttwo-chosen").html(this.opts.escapeMarkup(t)),this.selection.addClass("selecttwo-default"),this.container.removeClass("selecttwo-allowclear")}},postprocessResults:function(t,e,s){var i=0,o=this;if(this.findHighlightableChoices().eachTwo(function(t,e){if(a(o.id(e.data("selecttwo-data")),o.opts.element.val()))return i=t,!1}),!1!==s&&(!0===e&&i>=0?this.highlight(i):this.highlight(0)),!0===e){var n=this.opts.minimumResultsForSearch;n>=0&&this.showSearch(O(t.results)>=n)}},showSearch:function(e){this.showSearchInput!==e&&(this.showSearchInput=e,this.dropdown.find(".selecttwo-search").toggleClass("selecttwo-search-hidden",!e),this.dropdown.find(".selecttwo-search").toggleClass("selecttwo-offscreen",!e),t(this.dropdown,this.container).toggleClass("selecttwo-with-searchbox",e))},onSelect:function(t,e){if(this.triggerSelect(t)){var s=this.opts.element.val(),i=this.data();this.opts.element.val(this.id(t)),this.updateSelection(t),this.opts.element.trigger({type:"selecttwo-selected",val:this.id(t),choice:t}),this.nextSearchTerm=this.opts.nextSearchTerm(t,this.search.val()),this.close(),e&&e.noFocus||!this.opts.shouldFocusInput(this)||this.focusser.focus(),a(s,this.id(t))||this.triggerChange({added:t,removed:i})}},updateSelection:function(t){var s,i,o=this.selection.find(".selecttwo-chosen");this.selection.data("selecttwo-data",t),o.empty(),null!==t&&(s=this.opts.formatSelection(t,o,this.opts.escapeMarkup)),s!==e&&o.append(s),(i=this.opts.formatSelectionCssClass(t,o))!==e&&o.addClass(i),this.selection.removeClass("selecttwo-default"),this.opts.allowClear&&this.getPlaceholder()!==e&&this.container.addClass("selecttwo-allowclear")},val:function(){var t,s=!1,i=null,o=this,n=this.data();if(0===arguments.length)return this.opts.element.val();if(t=arguments[0],arguments.length>1&&(s=arguments[1]),this.select)this.select.val(t).find("option").filter(function(){return this.selected}).eachTwo(function(t,e){return i=o.optionToData(e),!1}),this.updateSelection(i),this.setPlaceholder(),s&&this.triggerChange({added:i,removed:n});else{if(!t&&0!==t)return void this.clear(s);if(this.opts.initSelection===e)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(t),this.opts.initSelection(this.opts.element,function(t){o.opts.element.val(t?o.id(t):""),o.updateSelection(t),o.setPlaceholder(),s&&o.triggerChange({added:t,removed:n})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(t){var s,i=!1;if(0===arguments.length)return(s=this.selection.data("selecttwo-data"))==e&&(s=null),s;arguments.length>1&&(i=arguments[1]),t?(s=this.data(),this.opts.element.val(t?this.id(t):""),this.updateSelection(t),i&&this.triggerChange({added:t,removed:s})):this.clear(i)}}),R=P(k,{createContainer:function(){return t(document.createElement("div")).attr({class:"selecttwo-container selecttwo-container-multi"}).html(["<ul class='selecttwo-choices'>","  <li class='selecttwo-search-field'>","    <label for='' class='selecttwo-offscreen'></label>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='selecttwo-input'>","  </li>","</ul>","<div class='selecttwo-drop selecttwo-drop-multi selecttwo-display-none'>","   <ul class='selecttwo-results'>","   </ul>","</div>"].join(""))},prepareOpts:function(){var e=this.parent.prepareOpts.apply(this,arguments),s=this;return"select"===e.element.get(0).tagName.toLowerCase()?e.initSelection=function(t,e){var i=[];t.find("option").filter(function(){return this.selected&&!this.disabled}).eachTwo(function(t,e){i.push(s.optionToData(e))}),e(i)}:"data"in e&&(e.initSelection=e.initSelection||function(s,i){var o=c(s.val(),e.separator),n=[];e.query({matcher:function(s,i,c){var r=t.grep(o,function(t){return a(t,e.id(c))}).length;return r&&n.push(c),r},callback:t.isFunction(i)?function(){for(var t=[],s=0;s<o.length;s++)for(var c=o[s],r=0;r<n.length;r++){var l=n[r];if(a(c,e.id(l))){t.push(l),n.splice(r,1);break}}i(t)}:t.noop})}),e},selectChoice:function(t){var e=this.container.find(".selecttwo-search-choice-focus");e.length&&t&&t[0]==e[0]||(e.length&&this.opts.element.trigger("choice-deselected",e),e.removeClass("selecttwo-search-choice-focus"),t&&t.length&&(this.close(),t.addClass("selecttwo-search-choice-focus"),this.opts.element.trigger("choice-selected",t)))},destroy:function(){t("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),I.call(this,"searchContainer","selection")},initContainer:function(){var e,s=".selecttwo-choices";this.searchContainer=this.container.find(".selecttwo-search-field"),this.selection=e=this.container.find(s);var i=this;this.selection.on("click",".selecttwo-search-choice:not(.selecttwo-locked)",function(e){i.search[0].focus(),i.selectChoice(t(this))}),this.search.attr("id","sTwoID_autogen"+D()),this.search.prev().text(t("label[for='"+this.opts.element.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(t){if(this.isInterfaceEnabled()){++this.keydowns;var s=e.find(".selecttwo-search-choice-focus"),i=s.prev(".selecttwo-search-choice:not(.selecttwo-locked)"),o=s.next(".selecttwo-search-choice:not(.selecttwo-locked)"),n=f(this.search);if(s.length&&(t.which==U.LEFT||t.which==U.RIGHT||t.which==U.BACKSPACE||t.which==U.DELETE||t.which==U.ENTER)){var a=s;return t.which==U.LEFT&&i.length?a=i:t.which==U.RIGHT?a=o.length?o:null:t.which===U.BACKSPACE?this.unselect(s.first())&&(this.search.width(10),a=i.length?i:o):t.which==U.DELETE?this.unselect(s.first())&&(this.search.width(10),a=o.length?o:null):t.which==U.ENTER&&(a=null),this.selectChoice(a),w(t),void(a&&a.length||this.open())}if((t.which===U.BACKSPACE&&1==this.keydowns||t.which==U.LEFT)&&0==n.offset&&!n.length)return this.selectChoice(e.find(".selecttwo-search-choice:not(.selecttwo-locked)").last()),void w(t);if(this.selectChoice(null),this.opened())switch(t.which){case U.UP:case U.DOWN:return this.moveHighlight(t.which===U.UP?-1:1),void w(t);case U.ENTER:return this.selectHighlighted(),void w(t);case U.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case U.ESC:return this.cancel(t),void w(t)}if(t.which!==U.TAB&&!U.isControl(t)&&!U.isFunctionKey(t)&&t.which!==U.BACKSPACE&&t.which!==U.ESC){if(t.which===U.ENTER){if(!1===this.opts.openOnEnter)return;if(t.altKey||t.ctrlKey||t.shiftKey||t.metaKey)return}this.open(),t.which!==U.PAGE_UP&&t.which!==U.PAGE_DOWN||w(t),t.which===U.ENTER&&w(t)}}})),this.search.on("keyup",this.bind(function(t){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(e){this.container.removeClass("selecttwo-container-active"),this.search.removeClass("selecttwo-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),e.stopImmediatePropagation(),this.opts.element.trigger(t.Event("selecttwo-blur"))})),this.container.on("click",s,this.bind(function(e){this.isInterfaceEnabled()&&(t(e.target).closest(".selecttwo-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("selecttwo-container-active")||this.opts.element.trigger(t.Event("selecttwo-focus")),this.open(),this.focusSearch(),e.preventDefault()))})),this.container.on("focus",s,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("selecttwo-container-active")||this.opts.element.trigger(t.Event("selecttwo-focus")),this.container.addClass("selecttwo-container-active"),this.dropdown.addClass("selecttwo-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass("selecttwo-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var t=this;this.opts.initSelection.call(null,this.opts.element,function(s){s!==e&&null!==s&&(t.updateSelection(s),t.close(),t.clearSearch())})}},clearSearch:function(){var t=this.getPlaceholder(),s=this.getMaxSearchWidth();t!==e&&0===this.getVal().length&&!1===this.search.hasClass("selecttwo-focused")?(this.search.val(t).addClass("selecttwo-default"),this.search.width(s>0?s:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("selecttwo-default")&&this.search.val("").removeClass("selecttwo-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),""===this.search.val()&&this.nextSearchTerm!=e&&(this.search.val(this.nextSearchTerm),this.search.select()),this.updateResults(!0),this.opts.shouldFocusInput(this)&&this.search.focus(),this.opts.element.trigger(t.Event("selecttwo-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("selecttwo-focused")},updateSelection:function(e){var s=[],i=[],n=this;t(e).each(function(){o(n.id(this),s)<0&&(s.push(n.id(this)),i.push(this))}),e=i,this.selection.find(".selecttwo-search-choice").remove(),t(e).each(function(){n.addSelectedChoice(this)}),n.postprocessResults()},tokenize:function(){var t=this.search.val();null!=(t=this.opts.tokenizer.call(this,t,this.data(),this.bind(this.onSelect),this.opts))&&t!=e&&(this.search.val(t),t.length>0&&this.open())},onSelect:function(t,s){this.triggerSelect(t)&&(this.addSelectedChoice(t),this.opts.element.trigger({type:"selected",val:this.id(t),choice:t}),this.nextSearchTerm=this.opts.nextSearchTerm(t,this.search.val()),this.clearSearch(),this.updateResults(),!this.select&&this.opts.closeOnSelect||this.postprocessResults(t,!1,!0===this.opts.closeOnSelect),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()?this.updateResults(!0):this.nextSearchTerm!=e&&(this.search.val(this.nextSearchTerm),this.updateResults(),this.search.select()),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:t}),s&&s.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(s){var i,o,n=!s.locked,a=t("<li class='selecttwo-search-choice'>    <div></div>    <a href='#' class='selecttwo-search-choice-close' tabindex='-1'></a></li>"),c=t("<li class='selecttwo-search-choice selecttwo-locked'><div></div></li>"),r=n?a:c,l=this.id(s),h=this.getVal();(i=this.opts.formatSelection(s,r.find("div"),this.opts.escapeMarkup))!=e&&r.find("div").replaceWith("<div>"+i+"</div>"),(o=this.opts.formatSelectionCssClass(s,r.find("div")))!=e&&r.addClass(o),n&&r.find(".selecttwo-search-choice-close").on("mousedown",w).on("click dblclick",this.bind(function(e){this.isInterfaceEnabled()&&(this.unselect(t(e.target)),this.selection.find(".selecttwo-search-choice-focus").removeClass("selecttwo-search-choice-focus"),w(e),this.close(),this.focusSearch())})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("selecttwo-container-active"),this.dropdown.addClass("selecttwo-drop-active"))})),r.data("selecttwo-data",s),r.insertBefore(this.searchContainer),h.push(l),this.setVal(h)},unselect:function(e){var s,i,n=this.getVal();if(0===(e=e.closest(".selecttwo-search-choice")).length)throw"Invalid argument: "+e+". Must be .selecttwo-search-choice";if(s=e.data("selecttwo-data")){var a=t.Event("selecttwo-removing");if(a.val=this.id(s),a.choice=s,this.opts.element.trigger(a),a.isDefaultPrevented())return!1;for(;(i=o(this.id(s),n))>=0;)n.splice(i,1),this.setVal(n),this.select&&this.postprocessResults();return e.remove(),this.opts.element.trigger({type:"selecttwo-removed",val:this.id(s),choice:s}),this.triggerChange({removed:s}),!0}},postprocessResults:function(t,e,s){var i=this.getVal(),n=this.results.find(".selecttwo-result"),a=this.results.find(".selecttwo-result-with-children"),c=this;n.eachTwo(function(t,e){o(c.id(e.data("selecttwo-data")),i)>=0&&(e.addClass("selecttwo-selected"),e.find(".selecttwo-result-selectable").addClass("selecttwo-selected"))}),a.eachTwo(function(t,e){e.is(".selecttwo-result-selectable")||0!==e.find(".selecttwo-result-selectable:not(.selecttwo-selected)").length||e.addClass("selecttwo-selected")}),-1==this.highlight()&&!1!==s&&c.highlight(0),!this.opts.createSearchChoice&&!n.filter(".selecttwo-result:not(.selecttwo-selected)").length>0&&(!t||t&&!t.more&&0===this.results.find(".selecttwo-no-results").length)&&E(c.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='selecttwo-no-results'>"+x(c.opts.formatNoMatches,c.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-r(this.search)},resizeSearch:function(){var t,e,s,i,o=r(this.search);t=m(this.search)+10,e=this.search.offset().left,(i=(s=this.selection.width())-(e-this.selection.offset().left)-o)<t&&(i=s-o),i<40&&(i=s-o),i<=0&&(i=t),this.search.width(Math.floor(i))},getVal:function(){var t;return this.select?(t=this.select.val(),null===t?[]:t):(t=this.opts.element.val(),c(t,this.opts.separator))},setVal:function(e){var s;this.select?this.select.val(e):(s=[],t(e).each(function(){o(this,s)<0&&s.push(this)}),this.opts.element.val(0===s.length?"":s.join(this.opts.separator)))},buildChangeDetails:function(t,e){for(var e=e.slice(0),t=t.slice(0),s=0;s<e.length;s++)for(var i=0;i<t.length;i++)a(this.opts.id(e[s]),this.opts.id(t[i]))&&(e.splice(s,1),s>0&&s--,t.splice(i,1),i--);return{added:e,removed:t}},val:function(s,i){var o,n=this;if(0===arguments.length)return this.getVal();if((o=this.data()).length||(o=[]),!s&&0!==s)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(i&&this.triggerChange({added:this.data(),removed:o}));if(this.setVal(s),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),i&&this.triggerChange(this.buildChangeDetails(o,this.data()));else{if(this.opts.initSelection===e)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(e){var s=t.map(e,n.id);n.setVal(s),n.updateSelection(e),n.clearSearch(),i&&n.triggerChange(n.buildChangeDetails(o,n.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var e=[],s=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".selecttwo-search-choice").each(function(){e.push(s.opts.id(t(this).data("selecttwo-data")))}),this.setVal(e),this.triggerChange()},data:function(e,s){var i,o,n=this;if(0===arguments.length)return this.selection.children(".selecttwo-search-choice").map(function(){return t(this).data("selecttwo-data")}).get();o=this.data(),e||(e=[]),i=t.map(e,function(t){return n.opts.id(t)}),this.setVal(i),this.updateSelection(e),this.clearSearch(),s&&this.triggerChange(this.buildChangeDetails(o,this.data()))}}),t.fn.selecttwo=function(){var s,i,n,a,c,r=Array.prototype.slice.call(arguments,0),l=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],h=["opened","isFocused","container","dropdown"],u=["val","data"],d={search:"externalSearch"};return this.each(function(){if(0===r.length||"object"==typeof r[0])(s=0===r.length?{}:t.extend({},r[0])).element=t(this),"select"===s.element.get(0).tagName.toLowerCase()?c=s.element.prop("multiple"):(c=s.multiple||!1,"tags"in s&&(s.multiple=c=!0)),(i=c?new window.SelectTwo.class.multi:new window.SelectTwo.class.single).init(s);else{if("string"!=typeof r[0])throw"Invalid arguments to selecttwo plugin: "+r;if(o(r[0],l)<0)throw"Unknown method: "+r[0];if(a=e,(i=t(this).data("selecttwo"))===e)return;if(n=r[0],"container"===n?a=i.container:"dropdown"===n?a=i.dropdown:(d[n]&&(n=d[n]),a=i[n].apply(i,r.slice(1))),o(r[0],h)>=0||o(r[0],u)>=0&&1==r.length)return!1}}),a===e?this:a},t.fn.selecttwo.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(t,e,s,i){var o=[];return b(t.text,s.term,o,i),o.join("")},formatSelection:function(t,s,i){return t?i(t.text):e},sortResults:function(t,e,s){return t},formatResultCssClass:function(t){return t.css},formatSelectionCssClass:function(t,s){return e},formatMatches:function(t){return t+" results are available, use up and down arrow keys to navigate."},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(t,e){var s=e-t.length;return"Please enter "+s+" or more character"+(1==s?"":"s")},formatInputTooLong:function(t,e){var s=t.length-e;return"Please delete "+s+" character"+(1==s?"":"s")},formatSelectionTooBig:function(t){return"You can only select "+t+" item"+(1==t?"":"s")},formatLoadMore:function(t){return"Loading more resultsâ€¦"},formatSearching:function(){return"Searchingâ€¦"},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(t){return t==e?null:t.id},matcher:function(t,e){return i(""+e).toUpperCase().indexOf(i(""+t).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:function(t,s,i,o){var n,c,r,l,h,u=t,d=!1;if(!o.createSearchChoice||!o.tokenSeparators||o.tokenSeparators.length<1)return e;for(;;){for(c=-1,r=0,l=o.tokenSeparators.length;r<l&&(h=o.tokenSeparators[r],!((c=t.indexOf(h))>=0));r++);if(c<0)break;if(n=t.substring(0,c),t=t.substring(c+h.length),n.length>0&&(n=o.createSearchChoice.call(this,n,s))!==e&&null!==n&&o.id(n)!==e&&null!==o.id(n)){for(d=!1,r=0,l=s.length;r<l;r++)if(a(o.id(n),o.id(s[r]))){d=!0;break}d||i(n)}}return u!==t?t:void 0},escapeMarkup:C,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(t){return t},adaptDropdownCssClass:function(t){return null},nextSearchTerm:function(t,s){return e},searchInputPlaceholder:"",createSearchChoicePosition:"top",shouldFocusInput:function(t){return!("ontouchstart"in window||navigator.msMaxTouchPoints>0)||!(t.opts.minimumResultsForSearch<0)}},t.fn.selecttwo.ajaxDefaults={transport:t.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.SelectTwo={query:{ajax:S,local:y,tags:T},util:{debounce:u,markMatch:b,escapeMarkup:C,stripDiacritics:i},class:{abstract:k,single:A,multi:R}}}}(jQuery);