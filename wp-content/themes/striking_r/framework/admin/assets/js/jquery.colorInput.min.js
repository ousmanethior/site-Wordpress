/*! jQuery ColorInput - v0.1.0 - 2012-12-16
* https://github.com/KaptinLin/colorInput
* Copyright (c) 2012 KaptinLin; Licensed GPL */

!function(t,e,i,o){"use strict";var s="colorInput",a={RGB:{match:/rgb\(\s*(\d{1,3}%?)\s*,\s*(\d{1,3}%?)\s*,\s*(\d{1,3}%?)\s*\)/i,parse:function(t){return{r:"%"===t[1].substr(-1)?parseInt(2.55*t[1].slice(0,-1),10):parseInt(t[1],10),g:"%"===t[2].substr(-1)?parseInt(2.55*t[2].slice(0,-1),10):parseInt(t[2],10),b:"%"===t[3].substr(-1)?parseInt(2.55*t[3].slice(0,-1),10):parseInt(t[3],10)}},to:function(t){return"rgb("+t.r+","+t.g+","+t.b+")"}},RGBA:{match:/rgba\(\s*(\d{1,3}%?)\s*,\s*(\d{1,3}%?)\s*,\s*(\d{1,3}%?)\s*,\s*(\d?(?:\.\d+)?)\s*\)/i,parse:function(t){return{r:"%"===t[1].substr(-1)?parseInt(2.55*t[1].slice(0,-1),10):parseInt(t[1],10),g:"%"===t[2].substr(-1)?parseInt(2.55*t[2].slice(0,-1),10):parseInt(t[2],10),b:"%"===t[3].substr(-1)?parseInt(2.55*t[3].slice(0,-1),10):parseInt(t[3],10),a:parseFloat(t[4])}},to:function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"}},HSL:{match:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*\)/i,parse:function(t){var e={h:(t[1]%360+360)%360,s:parseFloat(t[2]/100),l:parseFloat(t[3]/100)};return r.HSLToRGB(e)},to:function(t){var e=r.RGBToHSL(t);return"hsl("+parseInt(e.h,10)+","+Math.round(100*e.s)+"%,"+Math.round(100*e.l)+"%)"}},HSLA:{match:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d?(?:\.\d+)?)\s*\)/i,parse:function(t){var e={h:(t[1]%360+360)%360,s:parseFloat(t[2]/100),l:parseFloat(t[3]/100),a:parseFloat(t[4])};return r.HSLToRGB(e)},to:function(t){var e=r.RGBToHSL(t);return"hsla("+parseInt(e.h,10)+","+Math.round(100*e.s)+"%,"+Math.round(100*e.l)+"%,"+t.a+")"}},HEX:{match:/#([a-f0-9]{6}|[a-f0-9]{3})/i,parse:function(t){var e,i=t[1];return 3===i.length&&(i=(e=i)?(3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6===e.length?e:null):null),{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16)}},to:function(t){var e=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return i.each(e,function(t,i){1===i.length&&(e[t]="0"+i)}),"#"+e.join("")}},TRANSPARENT:{match:/transparent/,parse:function(t){return{r:0,g:0,b:0,a:0}},to:function(t){return"transparent"}}},r=i.colorValue=function(t,e){this.value={r:0,g:0,b:0,h:0,s:0,v:0,a:1},this._format="HEX",this.init(t,e)};r.prototype={constructor:r,init:function(t,e,i){if(this.onChange="function"==typeof i?i:function(){},void 0!==e)this.format(e);else for(var o in a){if(null!=a[o].match.exec(t)){this.format(o);break}}this.from(t)},from:function(t,e){if("string"==typeof t){var i=null;for(var o in a)if(null!=(i=a[o].match.exec(t))){this.set(a[o].parse(i));break}}else"object"==typeof t&&this.set(t)},format:function(t){if("string"!=typeof t||!(t=t.toUpperCase())||void 0===a[t])return this._format;"TRANSPARENT"!==t&&(this._format=t)},toRGBA:function(){return a.RGBA.to(this.value)},toRGB:function(){return a.RGB.to(this.value)},toHSLA:function(){return a.HSLA.to(this.value)},toHSL:function(){return a.HSL.to(this.value)},toHEX:function(){return a.HEX.to(this.value)},toString:function(){return 0===this.value.a?a.TRANSPARENT.to(this.value):a[this.format()].to(this.value)},get:function(){return this.value},set:function(t){var e=0,i=0;for(var s in t)-1!=="hsv".indexOf(s)?(i++,this.value[s]=t[s]):-1!=="rgb".indexOf(s)?(e++,this.value[s]=t[s]):"a"===s&&(this.value.a=t.a);if(e>i){var a=r.RGBtoHSV(this.value);0===this.value.r&&0===this.value.g&&0===this.value.b&&t.h!==o?this.value.h=t.h:this.value.h=a.h,this.value.s=a.s,this.value.v=a.v}else if(i>e){var n=r.HSVtoRGB(this.value);this.value.r=n.r,this.value.g=n.g,this.value.b=n.b}}},r.HSLToRGB=function(t){var e,i,o=t.h/360,s=t.s,a=t.l;e=2*a-(i=a<=.5?a*(s+1):a+s-a*s);var n={r:r.hueToRGB(e,i,o+1/3),g:r.hueToRGB(e,i,o),b:r.hueToRGB(e,i,o-1/3)};return void 0!==t.a&&(n.a=t.a),0===t.l&&(n.h=t.h),n},r.hueToRGB=function(t,e,i){var o;return i<0?i+=1:i>1&&(i-=1),o=6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t,Math.round(255*o)},r.RGBToHSL=function(t){var e,i,o=t.r/255,s=t.g/255,a=t.b/255,r=Math.min(o,s,a),n=Math.max(o,s,a),h=n-r,u=n+r,p=.5*u;return e=r===n?0:o===n?60*(s-a)/h+360:s===n?60*(a-o)/h+120:60*(o-s)/h+240,i=0===h?0:p<=.5?h/u:h/(2-u),{h:Math.round(e)%360,s:i,l:p}},r.RGBToHEX=function(t){return a.HEX.to(t)},r.HSLToHEX=function(t){var e=r.HSLToRGB(t);return a.HEX.to(e)},r.HSVtoHEX=function(t){var e=r.HSVtoRGB(t);return a.HEX.to(e)},r.RGBtoHSV=function(t){var e,i,o=t.r/255,s=t.g/255,a=t.b/255,r=Math.max(o,s,a),n=Math.min(o,s,a),h=r,u=r-n;if(i=0===r?0:u/r,r===n)e=0;else{switch(r){case o:e=(s-a)/u+(s<a?6:0);break;case s:e=(a-o)/u+2;break;case a:e=(o-s)/u+4}e/=6}return{h:360*e,s:i,v:h}},r.HSVtoRGB=function(t){var e,i,o,s=t.h%360/60,a=t.s,r=t.v,n=r*a,h=n*(1-Math.abs(s%2-1));return e=i=o=r-n,e+=[n,h,0,0,h,n][s=~~s],i+=[h,n,n,h,0,0][s],o+=[0,0,h,n,n,h][s],{r:Math.round(255*e),g:Math.round(255*i),b:Math.round(255*o)}};var n=i.colorInput=function(t,e){this.input=t,this.$input=i(t),this.$picker=i("<div>");var o=[];for(var s in i.each(this.$input.data(),function(t,e){var i=new RegExp("^color","i");i.test(t)&&(o[t.toLowerCase().replace(i,"")]=e)}),this.options=i.extend(!0,{},n.defaults,e,o),this.components=i.extend(!0,{},this.components),this.components)void 0!==this.options.components[s]&&!1===this.options.components[s]&&delete this.components[s];this.options.format||(this.options.format=this.options.format||"hex"),""===this.input.value?this.color=new r({r:255,g:255,b:255,a:1},this.options.format):this.color=new r(this.input.value,this.options.format),this.created=!1,this.create()};n.prototype={constructor:n,components:{},create:function(){for(var t in this.created=!0,this.$picker=i(this.options.template.picker),this.components)this.components[t].init(this);this.$input.addClass("colorinput");var e=this;this.$input.on({"focus.colorinput":function(){e.show()},"keydown.colorinput":function(t){9===t.keyCode?e.hide():13===t.keyCode&&(e.color.from(e.$input.val()),e.update({},"input"),e.hide())},"keyup.colorinput":function(){e.color.from(e.$input.val()),e.update({},"input")}}),(this.options.readonly||this.$input.prop("readonly"))&&this.readonly(!0),(this.options.disabled||this.$input.prop("disabled"))&&this.disabled(!0)},destroy:function(){for(var t in this.created=!1,this.hide(),this.components)this.components[t].destroy(this);this.$picker.remove(),this.$input.removeClass("colorinput").removeData().off(".colorinput")},update:function(t,e){var o=this;t!=={}&&o.color.set(t),i.each(o.components,function(t,i){e!==t&&i.update.call(i,o)}),"input"!==e&&(o.$input.val(o.color.toString()),o.$input.trigger("change"))},show:function(){if(this.$input.prop("disabled"))return!1;var o=this;0===this.$picker.parent().length&&this.$picker.appendTo("body").on("mousedown.colorinput",function(t){t.stopPropagation();var e=i(t.target).closest(".colorinput-picker > div");i.each(o.components,function(i,s){if(e.is(s.selector)&&"function"==typeof s.mousedown)return t.preventDefault(),s.mousedown(o,t)})}),this.place(),this.$picker.show(),i(e).on("mousedown.colorinput",function(t){if(!i(t.target).is(o.$input))return o.hide(),!1}),i(t).on("resize.colorinput",i.proxy(this.place,this))},hide:function(){this.$picker.hide(),this.$input.blur(),i(e).off("mousedown.colorinput"),i(t).off("resize.colorinput")},place:function(){var e,o,s=!this.$input.is(":visible"),a=s?this.$trigger.offset():this.$input.offset(),r=s?this.$trigger.outerHeight():this.$input.outerHeight(),n=s?this.$trigger.outerWidth():this.$input.outerWidth()+this.$trigger.outerWidth(),h=this.$picker.outerWidth(),u=this.$picker.outerHeight();e=u+a.top>i(t).height()+i(t).scrollTop()?a.top-u:a.top+r,o=h+a.left>i(t).width()+i(t).scrollLeft()?a.left-h+n:a.left,this.$picker.css({top:e,left:o})},readonly:function(t){return this.created&&this.$input.prop("readonly",t),this},disabled:function(t){return this.created&&this.$input.prop("disabled",t),t?this.$picker.addClass("is-disabled"):this.$picker.removeClass("is-disabled"),this},value:function(t){if(!t)return this.color.toString();this.color.from(t),this.update()},opacity:function(t){if(!t)return this.color.value.a;this.update({a:t})}},n.registerComponent=function(t,e){n.prototype.components[t]=e},n.registerComponent("trigger",{selector:".colorinput-trigger",template:'<span class="colorinput-trigger"><span></span></span>',init:function(t){t.$trigger=i(this.template),this.$trigger_inner=t.$trigger.children("span"),t.$trigger.insertAfter(t.$input),t.$trigger.on({click:i.proxy(t.show,t)}),this.update(t)},update:function(t){this.$trigger_inner.css("backgroundColor",t.color.toRGBA())},destroy:function(t){t.$trigger.remove()}}),n.registerComponent("saturation",{selector:".colorinput-picker-saturation",template:'<div class="colorinput-picker-saturation"><i><b></b></i></div>',width:150,height:150,size:6,data:{},init:function(t){this.$saturation=i(this.template).appendTo(t.$picker),this.$handle=this.$saturation.children("i"),this.update(t)},mousedown:function(t,o){var s=this.$saturation.offset();return this.data.startY=o.pageY,this.data.startX=o.pageX,this.data.top=o.pageY-s.top,this.data.left=o.pageX-s.left,this.move(t,this.data.left,this.data.top),this.mousemove=function(e){e.stopPropagation(),e.preventDefault();var i=this.data.left+(e.pageX||this.data.startX)-this.data.startX,o=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,i,o),!1},this.mouseup=function(t){return t.stopPropagation(),t.preventDefault(),i(e).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},i(e).on({mousemove:i.proxy(this.mousemove,this),mouseup:i.proxy(this.mouseup,this)}),!1},move:function(t,e,i,o){if(i=Math.max(0,Math.min(this.height,i)),e=Math.max(0,Math.min(this.width,e)),this.$handle.css({top:i-this.size,left:e-this.size}),!1!==o){var s={s:e/this.width,v:1-i/this.height};0===t.color.value.a&&(s.a=1),t.update(s,"saturation")}},update:function(t){this.$saturation.css("backgroundColor",r.HSLToHEX({h:t.color.value.h,s:1,l:.5}));var e=t.color.value.s*this.width,i=(1-t.color.value.v)*this.height;this.move(t,e,i,!1)},destroy:function(t){i(e).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),n.registerComponent("hue",{selector:".colorinput-picker-hue",template:'<div class="colorinput-picker-hue"><i></i></div>',height:150,data:{},init:function(t){this.$hue=i(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.update(t)},mousedown:function(t,o){var s=this.$hue.offset();return this.data.startY=o.pageY,this.data.top=o.pageY-s.top,this.move(t,this.data.top),this.mousemove=function(e){e.stopPropagation(),e.preventDefault();var i=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,i),!1},this.mouseup=function(t){return t.stopPropagation(),t.preventDefault(),i(e).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},i(e).on({mousemove:i.proxy(this.mousemove,this),mouseup:i.proxy(this.mouseup,this)}),!1},move:function(t,e,i,o){e=Math.max(0,Math.min(this.height,e)),void 0===i&&(i=360*(1-e/this.height)),i=Math.max(0,Math.min(360,i)),this.$handle.css({top:e,background:r.HSVtoHEX({h:i,s:1,v:1})}),!1!==o&&t.update({h:i},"hue")},update:function(t){var e=0===t.color.value.h?0:this.height*(1-t.color.value.h/360);this.move(t,e,t.color.value.h,!1)},destroy:function(t){i(e).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),n.registerComponent("alpha",{selector:".colorinput-picker-alpha",template:'<div class="colorinput-picker-alpha"><i></i></div>',height:150,data:{},init:function(t){this.$alpha=i(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.update(t)},mousedown:function(t,o){var s=this.$alpha.offset();return this.data.startY=o.pageY,this.data.top=o.pageY-s.top,this.move(t,this.data.top),this.mousemove=function(e){e.stopPropagation(),e.preventDefault();var i=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,i),!1},this.mouseup=function(t){return t.stopPropagation(),t.preventDefault(),i(e).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},i(e).on({mousemove:i.proxy(this.mousemove,this),mouseup:i.proxy(this.mouseup,this)}),!1},move:function(t,e,i,o){e=Math.max(0,Math.min(this.height,e)),void 0===i&&(i=1-e/this.height),i=Math.max(0,Math.min(1,i)),this.$handle.css({top:e}),!1!==o&&t.update({a:Math.round(100*i)/100},"alpha")},update:function(t){var e=this.height*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,e,t.color.value.a,!1)},destroy:function(t){i(e).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),n.registerComponent("extra",{selector:".colorinput-picker-extra",template:'<div class="colorinput-picker-extra"><ul class="colorinput-picker-sets"><li data-color="white">white</li><li data-color="black">black</li><li data-color="transparent">transparent</li></ul><ul class="colorinput-picker-info"><li><label>R:<input type="text" data-type="r"/></label></li><li><label>G:<input type="text" data-type="g"/></label></li><li><label>B:<input type="text" data-type="b"/></label></li><li><label>A:<input type="text" data-type="a"/></label></li></ul><input type="text" class="colorinput-picker-hex" /><div class="colorinput-picker-preview"><div></div></div></div>',height:150,data:{},init:function(t){this.$extra=i(this.template),this.$extra.$r=this.$extra.find('[data-type="r"]'),this.$extra.$g=this.$extra.find('[data-type="g"]'),this.$extra.$b=this.$extra.find('[data-type="b"]'),this.$extra.$a=this.$extra.find('[data-type="a"]'),this.$extra.$hex=this.$extra.find(".colorinput-picker-hex"),this.$extra.$preview=this.$extra.find(".colorinput-picker-preview div"),this.$extra.find(".colorinput-picker-sets").delegate("li","click",function(e){var o={};switch(i(e.target).data("color")){case"white":o={r:255,g:255,b:255,a:1};break;case"black":o={r:0,g:0,b:0,a:1};break;case"transparent":o={r:255,g:255,b:255,a:0}}t.value(o),t.hide()}),this.$extra.find(".colorinput-picker-info").delegate("input","change",function(e){var o,s=i(e.target).data("type");switch(s){case"r":case"g":case"b":(o=parseInt(this.value,10))>255?o=255:o<0&&(o=0);break;case"a":(o=parseFloat(this.value,10))>1?o=1:o<0&&(o=0)}var a={};a[s]=o,t.value(a)}),this.$extra.$hex.on("change",function(){t.value(this.value)}),this.update(t),this.$extra.appendTo(t.$picker)},update:function(t){this.$extra.$r.val(t.color.value.r),this.$extra.$g.val(t.color.value.g),this.$extra.$b.val(t.color.value.b),this.$extra.$a.val(t.color.value.a),this.$extra.$hex.val(t.color.toHEX()),this.$extra.$preview.css("backgroundColor",t.color.toRGBA())}}),n.defaults={disabled:!1,readonly:!1,format:null,components:{saturation:!0,hue:!0,alpha:!0,extra:!0},template:{picker:'<div class="colorinput-picker"></div>'}},i.fn.colorInput=function(t){if("string"==typeof t){var e=t,a=arguments.length>1?Array.prototype.slice.call(arguments,1):o;return this.each(function(){var t=i.data(this,s);"function"==typeof t[e]&&t[e].apply(t,a)})}return this.each(function(){i.data(this,s)||i.data(this,s,new n(this,t))})}}(window,document,jQuery);